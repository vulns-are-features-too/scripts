#!/bin/bash
# Scan all ports then run script scans on found ports
set -e
if [ $# -ne 1 ]; then
  echo "Usage: $(basename "$0") TARGET" >&2
  exit 1
fi

sudo nmap "$1" -p- -sS -Pn -oA tcp_ports -vv
ports="$(grep '/tcp' tcp_ports.nmap | cut -d/ -f1 | tr '\n' ',')"
nmap "$1" -p "$ports" -sCV -Pn -oA tcp_script
notify-send "TCP all-ports nmap $1 done"
